<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>관리자 대시보드</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100">
  <div class="max-w-6xl mx-auto p-6">
    <h1 class="text-2xl font-bold mb-6">관리자 대시보드</h1>
    <button id="logoutBtn" class="bg-gray-600 text-white px-3 py-1 rounded mb-6">로그아웃</button>
    <div id="rental-list" class="space-y-4"></div>
  </div>

  <script>
    const firebaseConfig = {
      // ... yonseirent-setup 웹 앱 config
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 인증 확인
    firebase.auth().onAuthStateChanged(user => {
      if (!user) {
        location.href = "admin-login.html";
      } else {
        // 로그인된 경우 목록 표시
        fetchRentals();
      }
    });

    // 로그아웃
    document.getElementById("logoutBtn").addEventListener("click", () => {
      firebase.auth().signOut().then(() => {
        location.href = "admin-login.html";
      });
    });

    function fetchRentals() {
      db.collection("rentals").orderBy("createdAt", "desc").onSnapshot(snapshot => {
        const container = document.getElementById("rental-list");
        container.innerHTML = "";

        snapshot.forEach(doc => {
          const data = doc.data();
          const docId = doc.id;
          container.innerHTML += renderRentalItem(docId, data);
        });
      });
    }

    function renderRentalItem(id, data) {
      return `
        <div class="bg-white p-4 rounded shadow">
          <p><strong>신청자:</strong> ${data.userEmail || "(이름 미입력)"}</p>
          <p><strong>장비:</strong> ${data.selectedItems?.join(", ") || "N/A"}</p>
          <p><strong>대여일자:</strong> ${data.startDate || "-"} ~ ${data.endDate || "-"}</p>
          <p><strong>상태:</strong> <span class="font-semibold">${data.status || "대기"}</span></p>
          ${data.proofImageURL ? `<p><strong>증명사진:</strong> <a href="${data.proofImageURL}" target="_blank" class="text-blue-600 underline">보기</a></p>` : ""}
          <div class="mt-2 space-x-2">
            <button class="px-3 py-1 bg-green-500 text-white rounded" onclick="updateStatus('${id}', '승인')">승인</button>
            <button class="px-3 py-1 bg-red-500 text-white rounded" onclick="updateStatus('${id}', '반려')">반려</button>
          </div>
        </div>
      `;
    }

    function updateStatus(docId, newStatus) {
      db.collection("rentals").doc(docId).update({ status: newStatus });
    }
  </script>
</body>
</html>
