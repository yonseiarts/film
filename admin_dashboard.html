
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>관리자 대시보드</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .active { background-color: #1D4ED8; color: white; }
    .inactive { background-color: #e5e7eb; color: #6b7280; }
  </style>
</head>
<body class="bg-gray-100">
  <!-- 헤더 -->
  <div class="bg-blue-700 text-white py-6 text-center relative">
    <a href="index.html" class="absolute left-4 top-1/2 -translate-y-1/2 transform text-white underline text-sm">홈으로</a>
    <h1 class="text-2xl font-bold">기자재 대여 관리자 대시보드</h1>
    <p class="text-sm mt-1">기자재 대여 신청 내역을 관리하세요.</p>
  </div>

  <!-- 관리자 대시보드 컨테이너 -->
  <div class="max-w-4xl mx-auto p-6 bg-white mt-6 rounded-lg shadow-md">
    <h2 class="text-xl font-bold mb-4">기자재 대여 신청 관리</h2>
    
    <!-- 신청 내역 테이블 -->
    <table class="min-w-full bg-white">
      <thead>
        <tr>
          <th class="py-3 px-4 border-b">신청자</th>
          <th class="py-3 px-4 border-b">신청한 장비</th>
          <th class="py-3 px-4 border-b">대여 시작일</th>
          <th class="py-3 px-4 border-b">대여 종료일</th>
          <th class="py-3 px-4 border-b">상태</th>
          <th class="py-3 px-4 border-b">관리</th>
        </tr>
      </thead>
      <tbody id="applicationList">
        <!-- Firebase에서 데이터 불러와서 이곳에 추가됩니다. -->
      </tbody>
    </table>
  </div>

  <!-- Firebase SDK & Initialization -->
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDqGToBXgmqiOBMpFSkKZOtbo4o5sCNjuQ",
      authDomain: "yonseirent-setup.firebaseapp.com",
      projectId: "yonseirent-setup",
      storageBucket: "yonseirent-setup.appspot.com",
      messagingSenderId: "1072524969376",
      appId: "1:1072524969376:web:0d7aa9875341262f3e10c5",
      measurementId: "G-CQZEKPE02D"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 신청 내역 로드 함수
    function loadApplications() {
      const applicationList = document.getElementById("applicationList");

      db.collection("rentals").get().then((querySnapshot) => {
        if (querySnapshot.empty) {
          applicationList.innerHTML = '<tr><td colspan="6" class="py-3 text-center">신청 내역이 없습니다.</td></tr>';
          return;
        }
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          const row = document.createElement("tr");
          
          row.innerHTML = `
            <td class="py-3 px-4 border-b">${data.studentName || '-'}</td>
            <td class="py-3 px-4 border-b">${data.items.join(', ') || '-'}</td>
            <td class="py-3 px-4 border-b">${data.startDate || '-'}</td>
            <td class="py-3 px-4 border-b">${data.endDate || '-'}</td>
            <td class="py-3 px-4 border-b">
              <span class="font-semibold ${data.status === '승인' ? 'text-green-600' : data.status === '반려' ? 'text-red-600' : 'text-yellow-600'}">${data.status || '-'}</span>
            </td>
            <td class="py-3 px-4 border-b">
              <button onclick="changeStatus('${doc.id}', '승인')" class="text-green-600">승인</button>
              <button onclick="changeStatus('${doc.id}', '반려')" class="text-red-600">반려</button>
            </td>
          `;
          
          applicationList.appendChild(row);
        });
      });
    }

    // 상태 변경 함수
    function changeStatus(docId, status) {
      db.collection("rentals").doc(docId).update({
        status: status
      }).then(() => {
        alert(`신청 상태가 ${status}로 변경되었습니다.`);
        loadApplications();  // 신청 내역 새로고침
      }).catch((error) => {
        console.error("Error updating status: ", error);
        alert("상태 변경에 실패했습니다. 다시 시도해주세요.");
      });
    }

    // 페이지 로드 시 신청 내역 불러오기
    document.addEventListener("DOMContentLoaded", loadApplications);
  </script>
</body>
</html>
