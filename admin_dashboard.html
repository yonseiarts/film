<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>관리자 대시보드</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .step-active { background-color: #1D4ED8; color: white; }
    .step-inactive { background-color: #e5e7eb; color: #6b7280; }
    .equipment-card {
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem;
      background-color: white;
      display: flex;
      align-items: center;
      gap: 1rem;
      cursor: pointer;
    }
    .equipment-card img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      flex-shrink: 0;
    }
    .equipment-card.disabled {
      opacity: 0.4;
      pointer-events: none;
      background-color: #f3f4f6;
    }
  </style>
</head>
<body class="bg-gray-50">

  <!-- 헤더 -->
  <div class="bg-blue-700 text-white py-6 text-center">
    <h1 class="text-2xl font-bold">관리자 대시보드</h1>
    <p class="text-sm mt-1">기자재 대여 신청 목록을 확인하고 관리하세요.</p>
  </div>

  <div class="max-w-4xl mx-auto p-6 bg-white mt-6 rounded-lg shadow-md">
    <div class="flex justify-between mb-8">
      <button id="approvedTab" class="text-center flex-1 p-2 rounded step-active">승인 대기</button>
      <button id="rejectedTab" class="text-center flex-1 p-2 rounded step-inactive">반려된 신청</button>
    </div>

    <!-- 승인 대기 목록 -->
    <div id="approvedSection">
      <h2 class="text-xl font-bold mb-4">승인 대기 신청 목록</h2>
      <div id="approvedList" class="space-y-4">
        <!-- 대여 신청 목록이 여기에 동적으로 추가됩니다 -->
      </div>
    </div>

    <!-- 반려된 신청 목록 -->
    <div id="rejectedSection" class="hidden">
      <h2 class="text-xl font-bold mb-4">반려된 신청 목록</h2>
      <div id="rejectedList" class="space-y-4">
        <!-- 반려된 대여 신청 목록이 여기에 동적으로 추가됩니다 -->
      </div>
    </div>

  </div>

  <!-- Firebase SDK & Initialization -->
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDqGToBXgmqiOBMpFSkKZOtbo4o5sCNjuQ",
      authDomain: "yonseirent-setup.firebaseapp.com",
      projectId: "yonseirent-setup",
      storageBucket: "yonseirent-setup.appspot.com",
      messagingSenderId: "1072524969376",
      appId: "1:1072524969376:web:0d7aa9875341262f3e10c5",
      measurementId: "G-CQZEKPE02D"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function loadApplications(status = '대기') {
      const q = db.collection("rentals").where("status", "==", status).orderBy("createdAt", "desc");
      const querySnapshot = await q.get();
      const list = status === '대기' ? document.getElementById("approvedList") : document.getElementById("rejectedList");

      list.innerHTML = "";

      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const div = document.createElement("div");
        div.className = "relative border rounded-lg p-5 mb-6 bg-white shadow-md";

        const actions = status === '대기' ?
          `<button onclick="approveApplication('${docSnap.id}')" class="absolute top-2 right-2 text-green-500 hover:text-green-700 text-sm">승인</button>
           <button onclick="rejectApplication('${docSnap.id}')" class="absolute top-2 right-14 text-red-500 hover:text-red-700 text-sm">반려</button>` :
          "";

        div.innerHTML = `
          ${actions}
          <h3 class="text-lg font-semibold text-blue-700 mb-2">신청 장비</h3>
          <ul class="list-disc ml-5 text-sm text-gray-800 mb-2">
            ${data.items?.map(item => `<li>${item}</li>`).join("") || "<li>-</li>"}
          </ul>
          <p class="text-sm text-gray-700 mb-1"><strong>대여일자:</strong> ${data.rentDate || "-"}</p>
          <p class="text-sm text-gray-700 mb-1"><strong>시작일:</strong> ${data.startDate || "-"}</p>
          <p class="text-sm text-gray-700 mb-1"><strong>반납일:</strong> ${data.endDate || "-"}</p>
          <p class="text-sm text-gray-700"><strong>상태:</strong> <span class="${data.status === '승인' ? 'text-green-600' : data.status === '반려' ? 'text-red-600' : 'text-yellow-600'} font-semibold">${data.status}</span></p>
        `;
        list.appendChild(div);
      });
    }

    function approveApplication(docId) {
      db.collection("rentals").doc(docId).update({ status: "승인" })
        .then(() => {
          loadApplications('대기');
          loadApplications('반려');
        })
        .catch(error => {
          alert("승인 처리 중 오류가 발생했습니다.");
          console.error("Error approving document: ", error);
        });
    }

    function rejectApplication(docId) {
      db.collection("rentals").doc(docId).update({ status: "반려" })
        .then(() => {
          loadApplications('대기');
          loadApplications('반려');
        })
        .catch(error => {
          alert("반려 처리 중 오류가 발생했습니다.");
          console.error("Error rejecting document: ", error);
        });
    }

    document.getElementById("approvedTab").addEventListener("click", () => {
      document.getElementById("approvedSection").classList.remove("hidden");
      document.getElementById("rejectedSection").classList.add("hidden");
      loadApplications('대기');
      document.getElementById("approvedTab").classList.add("step-active");
      document.getElementById("rejectedTab").classList.remove("step-active");
    });

    document.getElementById("rejectedTab").addEventListener("click", () => {
      document.getElementById("rejectedSection").classList.remove("hidden");
      document.getElementById("approvedSection").classList.add("hidden");
      loadApplications('반려');
      document.getElementById("rejectedTab").classList.add("step-active");
      document.getElementById("approvedTab").classList.remove("step-active");
    });

    document.addEventListener("DOMContentLoaded", () => {
      loadApplications('대기');
    });
  </script>
</body>
</html>
