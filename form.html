<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ê¸°ìì¬ ëŒ€ì—¬ ì‹ ì²­</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tab-button.active { background-color: #3b82f6; color: white; font-weight: 600; }
    .subtab-button.active { background-color: #dbeafe; font-weight: 600; }
    .equipment-card { border: 1px solid #e5e7eb; padding: 1rem; border-radius: 0.5rem; background-color: white; }
    .step { display: none; }
    .step.active { display: block; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 p-6">
  <h1 class="text-2xl font-bold mb-4">ğŸ¬ ê¸°ìì¬ ëŒ€ì—¬ ì‹ ì²­</h1>

  <!-- STEP 1: ì¥ë¹„ ì„ íƒ -->
  <div id="step1" class="step active">
    <h2 class="text-xl font-semibold mb-2">1ë‹¨ê³„: ì¥ë¹„ ì„ íƒ</h2>
    <div class="flex flex-wrap gap-2 mb-4">
      <button class="tab-button active px-4 py-2 rounded" data-tab="camera">ì¹´ë©”ë¼</button>
      <button class="tab-button px-4 py-2 rounded" data-tab="lighting">ì¡°ëª…</button>
      <button class="tab-button px-4 py-2 rounded" data-tab="sound">ì‚¬ìš´ë“œ</button>
      <button class="tab-button px-4 py-2 rounded" data-tab="monitor">ëª¨ë‹ˆí„°</button>
      <button class="tab-button px-4 py-2 rounded" data-tab="editing">í¸ì§‘ì‹¤</button>
      <button class="tab-button px-4 py-2 rounded" data-tab="line">ë¼ì¸</button>
    </div>

    <div id="cameraSubTabs" class="flex gap-2 mb-4">
      <button class="subtab-button active px-3 py-1 rounded text-sm" data-subtab="body">ë°”ë””</button>
      <button class="subtab-button px-3 py-1 rounded text-sm" data-subtab="lens">ë Œì¦ˆ</button>
      <button class="subtab-button px-3 py-1 rounded text-sm" data-subtab="tripod">ì‚¼ê°ëŒ€</button>
    </div>

    <div id="equipmentList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    <div class="mt-6 flex justify-end">
      <button onclick="goToStep(2)" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ë‹¤ìŒ ë‹¨ê³„ â†’</button>
    </div>
  </div>
  <!-- STEP 2: ëŒ€ì—¬ì¼ ì„ íƒ -->
  <div id="step2" class="step">
    <h2 class="text-xl font-semibold mb-4">2ë‹¨ê³„: ëŒ€ì—¬ì¼ ì„ íƒ</h2>
    <div id="commonDateSection">
      <label class="block mb-1 font-medium">ëŒ€ì—¬ ì‹œì‘ì¼</label>
      <input type="date" id="startDate" class="border p-2 rounded mb-4 w-full">
      <label class="block mb-1 font-medium">ë°˜ë‚©ì¼</label>
      <input type="date" id="endDate" class="border p-2 rounded mb-4 w-full">
      <label class="block mb-1 font-medium">ì¦ëª…ì‚¬ì§„ ì—…ë¡œë“œ</label>
      <input type="file" id="proofImage" class="mb-4">
    </div>

    <div id="editingDateSection" class="hidden">
      <label class="block mb-1 font-medium">í¸ì§‘ì‹¤ ëŒ€ì—¬ì¼ì</label>
      <input type="date" id="editingDate" class="border p-2 rounded mb-4 w-full">
      <label class="block mb-1 font-medium">ì‹œê°„ ì„ íƒ</label>
      <div id="timeGrid" class="grid grid-cols-6 gap-2"></div>
    </div>

    <div class="mt-6 flex justify-between">
      <button onclick="goToStep(1)" class="px-4 py-2 bg-gray-300 text-gray-800 rounded">â† ì´ì „</button>
      <button onclick="goToStep(3)" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ë‹¤ìŒ ë‹¨ê³„ â†’</button>
    </div>
  </div>

  <!-- STEP 3: ê·œì • ë™ì˜ -->
  <div id="step3" class="step">
    <h2 class="text-xl font-semibold mb-4">3ë‹¨ê³„: ê¸°ìì¬ ì‚¬ìš© ê·œì • ë™ì˜</h2>
    <div class="bg-white p-4 border rounded mb-4 h-60 overflow-y-scroll text-sm">
      <strong>ê¸°ìì¬ ëŒ€ì—¬ ê·œì •</strong><br/>
      â€¢ ëŒ€ì—¬ ì¥ë¹„ëŠ” ì§€ì •ëœ ê¸°ê°„ ë‚´ ë°˜ë‚©í•´ì•¼ í•©ë‹ˆë‹¤.<br/>
      â€¢ íŒŒì† ë˜ëŠ” ë¶„ì‹¤ ì‹œ ì „ì•¡ ë³€ìƒ.<br/>
      â€¢ ì—°ì²´ ì‹œ í–¥í›„ ëŒ€ì—¬ ë¶ˆê°€.<br/>
      â€¢ í¸ì§‘ì‹¤ì€ ì˜ˆì•½ ì‹œê°„ ì—„ìˆ˜.<br/>
      â€¢ ì™¸ë¶€ ë°˜ì¶œ ì‹œ ì‚¬ì „ ìŠ¹ì¸ í•„ìš”.<br/>
    </div>
    <label class="inline-flex items-center">
      <input type="checkbox" id="agreeCheck" class="mr-2">
      ê·œì •ì— ë™ì˜í•©ë‹ˆë‹¤.
    </label>
    <div class="mt-6 flex justify-between">
      <button onclick="goToStep(2)" class="px-4 py-2 bg-gray-300 text-gray-800 rounded">â† ì´ì „</button>
      <button onclick="goToStep(4)" id="submitBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" disabled>ì‹ ì²­ ì™„ë£Œ</button>
    </div>
  </div>
  <!-- STEP 4: ì™„ë£Œ í™”ë©´ -->
  <div id="step4" class="step text-center py-16">
    <h2 class="text-2xl font-bold text-green-600 mb-4">âœ… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
    <p class="text-lg text-gray-700">ì„ íƒí•œ ì¥ë¹„ ë° ëŒ€ì—¬ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
    <div class="mt-6 text-sm text-gray-700" id="finalSummary"></div>
    <button onclick="goToStep(1)" class="mt-8 px-4 py-2 bg-gray-500 text-white rounded">ì²˜ìŒìœ¼ë¡œ</button>
  </div>

  <!-- Firebase ë° ìŠ¤í¬ë¦½íŠ¸ -->
  <script type="module">
    import {{ initializeApp }} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {{ getFirestore, collection, addDoc, serverTimestamp }} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {{
      apiKey: "AIzaSyDqGToBXgmqiOBMpFSkKZOtbo4o5sCNjuQ",
      authDomain: "yonseirent-setup.firebaseapp.com",
      projectId: "yonseirent-setup",
      storageBucket: "yonseirent-setup.appspot.com",
      messagingSenderId: "1072524969376",
      appId: "1:1072524969376:web:33d1c55ca9f08da93e10c5"
    }};
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ì„ íƒëœ ì¥ë¹„ ì„ì‹œ ë³´ê´€
    let currentTab = "camera";
    let currentSubTab = "body";
    const selectedItems = [];

    // ì¥ë¹„ ë Œë”ë§
    const equipmentData = {equipment_json};  // ì´ ì¤„ì€ ì„œë²„ ë Œë”ë§ ì‹œ ì‚½ì…ë¨
    const list = document.getElementById("equipmentList");

    function renderEquipment() {{
      list.innerHTML = "";
      const data = currentTab === "camera" ? equipmentData.camera[currentSubTab] : equipmentData[currentTab];
      data.forEach(item => {{
        const div = document.createElement("div");
        div.className = "equipment-card cursor-pointer hover:ring-2";
        div.innerHTML = `
          <img src="${{item.image}}" class="w-20 h-20 rounded mb-2">
          <p class="font-semibold">${{item.name}}</p>`;
        div.onclick = () => {{
          if (!selectedItems.includes(item.name)) {{
            selectedItems.push(item.name);
            div.classList.add("ring", "ring-yellow-400");
          }}
        }};
        list.appendChild(div);
      }});
    }}

    // íƒ­ ë³€ê²½
    document.querySelectorAll(".tab-button").forEach(btn => {{
      btn.addEventListener("click", () => {{
        document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentTab = btn.dataset.tab;
        currentSubTab = "body";
        document.getElementById("cameraSubTabs").style.display = (currentTab === "camera") ? "flex" : "none";
        renderEquipment();
      }});
    }});
    document.querySelectorAll(".subtab-button").forEach(btn => {{
      btn.addEventListener("click", () => {{
        document.querySelectorAll(".subtab-button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentSubTab = btn.dataset.subtab;
        renderEquipment();
      }});
    }});

    renderEquipment();

    // step ì´ë™
    function goToStep(n) {{
      document.querySelectorAll(".step").forEach(s => s.classList.remove("active"));
      document.getElementById("step" + n).classList.add("active");
      if (n === 4) showSummary();
    }}

    // ê·œì • ë™ì˜ ì²´í¬
    document.getElementById("agreeCheck").addEventListener("change", (e) => {{
      document.getElementById("submitBtn").disabled = !e.target.checked;
    }});

    // ì™„ë£Œ ìš”ì•½ ì¶œë ¥
    function showSummary() {{
      const summary = document.getElementById("finalSummary");
      const items = selectedItems.join(", ");
      const start = document.getElementById("startDate")?.value || "";
      const end = document.getElementById("endDate")?.value || "";
      const editDate = document.getElementById("editingDate")?.value || "";
      const date = (editDate || (start + " ~ " + end));
      summary.innerHTML = `
        <p><strong>ì„ íƒ ì¥ë¹„:</strong> ${items}</p>
        <p><strong>ëŒ€ì—¬ì¼ì:</strong> ${date}</p>`;
      saveApplication(items, date);
    }}

    // Firestore ì €ì¥
    async function saveApplication(equipmentList, rentDate) {{
      try {{
        await addDoc(collection(db, "applications"), {{
          userName: "í•™ìƒ",
          studentID: "12345678",
          equipment: equipmentList,
          rentDate,
          status: "ëŒ€ê¸°",
          isDeleted: false,
          createdAt: serverTimestamp()
        }});
      }} catch (err) {{
        alert("ì €ì¥ ì˜¤ë¥˜: " + err.message);
      }}
    }}
  </script>
</body>
</html>
