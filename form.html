<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>기자재 대여 신청</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <script type="module">
    // Firebase SDK 초기화
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { firebaseConfig } from "./firebaseConfig.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 폼 제출 처리
    async function handleSubmit() {
      const selectedItems = document.getElementById("selected-items").innerText;
      const startDate = document.getElementById("startDate").value;
      const endDate = document.getElementById("endDate").value;
      const proofImage = document.getElementById("proofImage").files[0];

      if (!selectedItems || !startDate || !endDate || !proofImage) {
        alert("모든 필드를 입력해 주세요.");
        return;
      }

      try {
        // Firestore에 대여 신청 정보 저장
        await addDoc(collection(db, "applications"), {
          items: selectedItems.split("\n"),
          startDate: startDate,
          endDate: endDate,
          proofImage: proofImage.name,  // 실제 이미지 URL을 Firebase Storage에 저장하는 방법 추가 필요
          timestamp: new Date(),
        });

        alert("대여 신청이 완료되었습니다.");
        window.location.href = "student_login.html";  // 대여 신청 후 로그인 페이지로 이동
      } catch (e) {
        console.error("Error adding document: ", e);
        alert("대여 신청에 실패했습니다. 다시 시도해주세요.");
      }
    }
  </script>
</head>
<body class="bg-gray-50">
  <div class="bg-blue-700 text-white py-6 text-center">
    <h1 class="text-2xl font-bold">기자재 대여 신청</h1>
  </div>

  <div class="max-w-4xl mx-auto p-6 bg-white mt-6 rounded-lg shadow-md">
    <!-- 대여 신청 폼 -->
    <div class="mb-4">
      <h2 class="text-xl font-bold mb-2">선택한 장비</h2>
      <ul id="selected-items" class="list-disc ml-5 text-sm text-gray-700">
        <!-- 선택한 장비 목록이 여기에 표시됩니다 -->
      </ul>
    </div>

    <div class="mb-4">
      <label class="block mb-2">대여 시작일</label>
      <input type="date" id="startDate" class="border p-2 w-full rounded" />
    </div>

    <div class="mb-4">
      <label class="block mb-2">대여 종료일</label>
      <input type="date" id="endDate" class="border p-2 w-full rounded" />
    </div>

    <div class="mb-4">
      <label class="block mb-2">증명사진 첨부</label>
      <input type="file" id="proofImage" class="block w-full border p-2 rounded" />
    </div>

    <div class="flex justify-between mt-6">
      <button onclick="handleSubmit()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        대여 신청하기
      </button>
    </div>
  </div>
</body>
</html>
